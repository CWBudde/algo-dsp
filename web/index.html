<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>algo-dsp Web Demo</title>
    <script>
      (() => {
        try {
          const stored = localStorage.getItem("algo-dsp-theme");
          const selected = stored === "light" || stored === "dark" || stored === "system" ? stored : "system";
          const mql = window.matchMedia("(prefers-color-scheme: dark)");
          const resolved = selected === "system" ? (mql.matches ? "dark" : "light") : selected;
          const root = document.documentElement;
          root.dataset.theme = selected;
          root.dataset.resolvedTheme = resolved;
        } catch {
          const root = document.documentElement;
          root.dataset.theme = "system";
          root.dataset.resolvedTheme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
        }
      })();
    </script>
    <link rel="stylesheet" href="styles.css" />
    <script src="eq-canvas.js" defer></script>
    <script src="wasm_exec.js" defer></script>
    <script src="app.js" defer></script>
  </head>
  <body>
    <main class="app">
      <header class="hero">
        <div class="hero-top">
          <h1>algo-dsp Web Demo</h1>
          <button id="theme-toggle" class="theme-toggle" type="button" title="Theme follows system until toggled" aria-label="Toggle theme">
            <svg
              class="theme-toggle-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              aria-hidden="true"
            >
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <span class="theme-toggle-label">Theme</span>
          </button>
        </div>
        <p>Step synthesizer (pure tones + decay) with realtime 5-node EQ.</p>
      </header>

      <section class="panel transport">
        <div class="row">
          <button id="run-toggle" class="icon-btn" type="button" aria-label="Play">
            <span class="icon icon-play" aria-hidden="true"></span>
            <span class="icon icon-stop" aria-hidden="true"></span>
            <span class="sr-only">Play</span>
          </button>
          <label>
            Tempo
            <input id="tempo" type="range" min="60" max="180" value="110" />
            <span id="tempo-value">110 BPM</span>
          </label>
          <label>
            Shuffle
            <input id="shuffle" type="range" min="0" max="1" step="0.01" value="0" />
            <span id="shuffle-value">0%</span>
          </label>
          <label>
            Decay
            <input id="decay" type="range" min="0.04" max="0.8" step="0.01" value="0.2" />
            <span id="decay-value">0.20 s</span>
          </label>
          <label>
            Waveform
            <select id="waveform">
              <option value="sine" selected>Sine</option>
              <option value="triangle">Triangle</option>
              <option value="saw">Saw</option>
              <option value="square">Square</option>
            </select>
          </label>
        </div>
      </section>

      <section class="panel">
        <h2>Steps</h2>
        <div id="steps" class="steps"></div>
      </section>

      <section class="panel eq-panel">
        <div class="eq-head">
          <h2>EQ</h2>
          <p id="eq-readout" class="eq-readout">Hover a node for details.</p>
        </div>
        <canvas id="eq-canvas" height="400" aria-label="Interactive EQ graph"></canvas>
        <div class="analyzer-band">
          <label>
            FFT Size
            <select id="analyzer-fft">
              <option value="256">256</option>
              <option value="512">512</option>
              <option value="1024">1024</option>
              <option value="2048" selected>2048</option>
              <option value="4096">4096</option>
              <option value="8192">8192</option>
            </select>
          </label>
          <label>
            Overlap
            <input id="analyzer-overlap" type="range" min="25" max="90" step="1" value="75" />
            <span id="analyzer-overlap-value">75% overlap (25% hop)</span>
          </label>
          <label>
            Window
            <select id="analyzer-window">
              <option value="hann">Hann</option>
              <option value="hamming">Hamming</option>
              <option value="blackman">Blackman</option>
              <option value="blackmanharris" selected>Blackman-Harris</option>
              <option value="flattop">Flat Top</option>
            </select>
          </label>
          <label>
            Smoothing
            <input id="analyzer-smoothing" type="range" min="0" max="0.95" step="0.01" value="0.65" />
            <span id="analyzer-smoothing-value">0.65</span>
          </label>
        </div>
        <div class="eq-meta">
        </div>
      </section>

      <section class="panel effects-panel">
        <h2>Effects</h2>
        <div class="effects-grid">
          <div class="fx-card">
            <div class="fx-head">
              <h3>Chorus</h3>
              <label class="fx-toggle">
                <input id="chorus-enabled" type="checkbox" />
                <span>On</span>
              </label>
            </div>
            <label>
              Mix
              <input id="chorus-mix" type="range" min="0" max="0.6" step="0.01" value="0.18" />
              <span id="chorus-mix-value">18%</span>
            </label>
            <label>
              Depth
              <input id="chorus-depth" type="range" min="0" max="0.01" step="0.0001" value="0.003" />
              <span id="chorus-depth-value">3.0 ms</span>
            </label>
            <label>
              Speed
              <input id="chorus-speed" type="range" min="0.05" max="5" step="0.01" value="0.35" />
              <span id="chorus-speed-value">0.35 Hz</span>
            </label>
            <label>
              Stages
              <input id="chorus-stages" type="range" min="1" max="6" step="1" value="3" />
              <span id="chorus-stages-value">3</span>
            </label>
          </div>

          <div class="fx-card">
            <div class="fx-head">
              <h3>Reverb</h3>
              <label class="fx-toggle">
                <input id="reverb-enabled" type="checkbox" />
                <span>On</span>
              </label>
            </div>
            <label>
              Wet
              <input id="reverb-wet" type="range" min="0" max="1" step="0.01" value="0.22" />
              <span id="reverb-wet-value">22%</span>
            </label>
            <label>
              Dry
              <input id="reverb-dry" type="range" min="0" max="1.5" step="0.01" value="1" />
              <span id="reverb-dry-value">1.00</span>
            </label>
            <label>
              Room
              <input id="reverb-room" type="range" min="0" max="0.98" step="0.01" value="0.72" />
              <span id="reverb-room-value">0.72</span>
            </label>
            <label>
              Damp
              <input id="reverb-damp" type="range" min="0" max="0.99" step="0.01" value="0.45" />
              <span id="reverb-damp-value">0.45</span>
            </label>
          </div>
        </div>
      </section>
    </main>
  </body>
</html>
